<?php
/**
 * @file
 * Module to simulate a poetry response.
 */

use Drupal\tmgmt_poetry_test\Mock\PoetryMock;

// Setting up templates directory path.
define('TMGMT_POETRY_TEST_TEMPLATES_PATH', drupal_get_path('module', 'tmgmt_poetry_test') . '/response_templates');
define('TMGMT_POETRY_TEST_REQUESTS_PATH', 'public://tmgmt_file/poetry_mock_requests/');
// Forms logic and overwriting functions.
module_load_include('inc', 'tmgmt_poetry_test', 'includes/tmgmt_poetry_test.theme');
module_load_include('inc', 'tmgmt_poetry_test', 'includes/tmgmt_poetry_test.actions');

/**
 * Implements hook_views_api().
 */
function tmgmt_poetry_test_views_api($module = NULL, $api = NULL) {
  return array("api" => "3.0");
}

/**
 * Implements hook_menu().
 */
function tmgmt_poetry_test_menu() {
  $items['tmgmt_poetry_test/soap_server'] = array(
    'title' => 'Poetry Soap Server',
    'page callback' => 'tmgmt_poetry_test_soap_server',
    'access arguments' => array('access content'),
    'type' => MENU_CALLBACK,
  );

  $items[drupal_get_path("module", "tmgmt_poetry_test") . "/tmgmt_poetry_test.wsdl"] = array(
    'page callback' => '_tmgmt_poetry_testl_wsdl',
    'access callback' => TRUE,
  );

  return $items;
}

/**
 * A page callback which simulate poetry webservice.
 */
function tmgmt_poetry_test_soap_server() {
  $poetry_mock = new PoetryMock();
  $poetry_mock->instantiateServer();
}

/**
 * Generate mock wsdl to simulate poetry.
 */
function _tmgmt_poetry_testl_wsdl() {
  $uri = url('tmgmt_poetry_test/soap_server', array('absolute' => TRUE, 'language' => (object) array('language' => FALSE)));
  $wsdl = theme('poetry_wsdl', array('uri' => $uri));
  drupal_add_http_header('Content-Type', 'application/xml; utf-8');
  print $wsdl;
  exit(0);
}
